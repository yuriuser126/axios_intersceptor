# Axios μΈν„°μ…‰ν„° λ°λ¨ ν”„λ΅μ νΈ

Next.js + React κΈ°λ°μΌλ΅ axios μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν• κ³µν†µ μ—λ¬ μ²λ¦¬ λ° ν† ν° κ΄€λ¦¬ λ°λ¨μ…λ‹λ‹¤.

## π€ λΉ λ¥Έ μ‹μ‘

### 1. μμ΅΄μ„± μ„¤μΉ
```bash
npm install
```

### 2. κ°λ° μ„λ²„ μ‹¤ν–‰
```bash
npm run dev
```

λΈλΌμ°μ €μ—μ„ `http://localhost:3000` μ ‘μ†

## π“– μ‚¬μ© λ°©λ²•

### κΈ°λ³Έ μ‚¬μ©λ²•

1. **ν† ν° μ„¤μ •**
   - μƒλ‹¨μ "ν† ν° μ…λ ¥" νΌμ—μ„ Access Tokenκ³Ό Refresh Tokenμ„ μ…λ ¥
   - "ν† ν° μ €μ¥" λ²„νΌ ν΄λ¦­
   - ν† ν°μ€ Zustand μ¤ν† μ–΄μ— μ €μ¥λλ©°, λ¨λ“  API μ”μ²­μ— μλ™μΌλ΅ ν¬ν•¨λ©λ‹λ‹¤

2. **μ •μƒ API νΈμ¶ ν…μ¤νΈ**
   - κ° API μΉ΄λ“μ "μ •μƒ νΈμ¶" λ²„νΌ ν΄λ¦­
   - μ •μƒμ μΌλ΅ μ‘λ‹µμ΄ μ¤λ”μ§€ ν™•μΈ

3. **401 ν† ν° λ§λ£ ν…μ¤νΈ**
   - Access Token μ…λ ¥λ€μ— `expired` μ…λ ¥
   - "ν† ν° μ €μ¥" ν΄λ¦­
   - κ° API μΉ΄λ“μ "π”µ 401" λ²„νΌ ν΄λ¦­
   - **λ™μ‘ κ³Όμ •:**
     1. API μ”μ²­ μ‹ 401 μ—λ¬ λ°μƒ
     2. μΈν„°μ…‰ν„°κ°€ μλ™μΌλ΅ refresh tokenμΌλ΅ μƒ access token λ°κΈ‰
     3. μ‹¤ν¨ν• μ”μ²­μ„ μƒ ν† ν°μΌλ΅ μλ™ μ¬μ‹λ„
     4. μ„±κ³µ μ‹ μ•λ¦Ό ν‘μ‹

4. **404/500 μ—λ¬ ν…μ¤νΈ**
   - κ° API μΉ΄λ“μ "π”΄ 404" λλ” "π  500" λ²„νΌ ν΄λ¦­
   - **λ™μ‘ κ³Όμ •:**
     1. API μ”μ²­ μ‹ 404 λλ” 500 μ—λ¬ λ°μƒ
     2. μΈν„°μ…‰ν„°κ°€ μλ™μΌλ΅ `/error` νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰νΈ
     3. μ—λ¬ νμ΄μ§€μ—μ„ λ°μƒν• APIμ™€ μƒνƒ μ½”λ“ ν™•μΈ κ°€λ¥

## π—οΈ ν”„λ΅μ νΈ κµ¬μ΅°

```
src/
β”β”€β”€ lib/
β”‚   β””β”€β”€ axios.ts          # axios μΈν„°μ…‰ν„° κ³µν†µ μ²λ¦¬ (ν•µμ‹¬ λ΅μ§)
β”β”€β”€ store/
β”‚   β””β”€β”€ auth.ts           # Zustand ν† ν° μ¤ν† μ–΄
β”β”€β”€ api/
β”‚   β””β”€β”€ demo.ts           # API νΈμ¶ ν•¨μλ“¤
β””β”€β”€ app/
    β”β”€β”€ page.tsx          # λ©”μΈ νμ΄μ§€ (λ°λ¨ UI)
    β”β”€β”€ error/
    β”‚   β””β”€β”€ page.tsx      # μ—λ¬ νμ΄μ§€
    β””β”€β”€ api/              # Next.js API λΌμ°νΈ (λ°λ¨μ©)
        β”β”€β”€ hq-erp/
        β”β”€β”€ client-app/
        β””β”€β”€ vendor-erp/
```

## π”§ ν•µμ‹¬ κΈ°λ¥ μ„¤λ…

### 1. μ”μ²­ μΈν„°μ…‰ν„°
**μ„μΉ:** `src/lib/axios.ts` - `attachInterceptors` ν•¨μ

**κΈ°λ¥:**
- λ¨λ“  API μ”μ²­μ— Authorization ν—¤λ” μλ™ μ¶”κ°€
- Zustand μ¤ν† μ–΄μ—μ„ accessTokenμ„ κ°€μ Έμ™€μ„ `Bearer {token}` ν•μ‹μΌλ΅ ν—¤λ”μ— μ¶”κ°€

**μ½”λ“ μμ‹:**
```typescript
instance.interceptors.request.use((config) => {
  const { accessToken } = useAuthStore.getState();
  if (accessToken) {
    config.headers = {
      ...config.headers,
      Authorization: `Bearer ${accessToken}`
    };
  }
  return config;
});
```

### 2. μ‘λ‹µ μΈν„°μ…‰ν„° - 401 μ²λ¦¬
**μ„μΉ:** `src/lib/axios.ts` - `attachInterceptors` ν•¨μ λ‚΄λ¶€

**κΈ°λ¥:**
- 401 μ—λ¬ λ°μƒ μ‹ μλ™μΌλ΅ refresh tokenμΌλ΅ μƒ access token λ°κΈ‰
- μ‹¤ν¨ν• μ”μ²­μ„ μƒ ν† ν°μΌλ΅ μλ™ μ¬μ‹λ„
- μ—¬λ¬ μ”μ²­μ΄ λ™μ‹μ— 401μ„ λ°›μ•„λ„ refreshλ” ν• λ²λ§ μ‹¤ν–‰ (μ¤‘λ³µ λ°©μ§€)

**μ²λ¦¬ νλ¦„:**
```
1. API μ”μ²­ β†’ 401 μ—λ¬ λ°μƒ
2. refresh tokenμΌλ΅ μƒ access token λ°κΈ‰
3. μ¤ν† μ–΄μ— μƒ ν† ν° μ €μ¥
4. μ‹¤ν¨ν• μ”μ²­μ„ μƒ ν† ν°μΌλ΅ μ¬μ‹λ„
5. μ„±κ³µ μ‹ μ •μƒ μ‘λ‹µ λ°ν™
```

**μ¤‘μ” ν¬μΈνΈ:**
- `_retry` ν”λκ·Έλ΅ λ¬΄ν• μ¬μ‹λ„ λ°©μ§€
- `isRefreshing` ν”λκ·Έλ΅ λ™μ‹ refresh μ”μ²­ μ¤‘λ³µ λ°©μ§€
- `refreshQueue`λ΅ refresh μ™„λ£λ¥Ό κΈ°λ‹¤λ¦¬λ” μ”μ²­λ“¤μ„ νμ— μ €μ¥

### 3. μ‘λ‹µ μΈν„°μ…‰ν„° - 404/500 μ²λ¦¬
**μ„μΉ:** `src/lib/axios.ts` - `handleGlobalError` ν•¨μ

**κΈ°λ¥:**
- 404/500 λ“± μ—λ¬ λ°μƒ μ‹ `/error` νμ΄μ§€λ΅ μλ™ λ¦¬λ‹¤μ΄λ ‰νΈ
- μ—λ¬ νμ΄μ§€μ—μ„ λ°μƒν• APIμ™€ μƒνƒ μ½”λ“ ν™•μΈ κ°€λ¥

**μ²λ¦¬ νλ¦„:**
```
1. API μ”μ²­ β†’ 404 λλ” 500 μ—λ¬ λ°μƒ
2. handleGlobalError ν•¨μ νΈμ¶
3. /error?status={status}&api={apiName} λ΅ λ¦¬λ‹¤μ΄λ ‰νΈ
4. μ—λ¬ νμ΄μ§€μ—μ„ μ •λ³΄ ν‘μ‹
```

## π’΅ ν€μ›λ“¤μ„ μ„ν• μ„¤λ…

### μ™ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ‚μ”?

1. **μ½”λ“ μ¤‘λ³µ μ κ±°**
   - λ§¤λ² API νΈμ¶ μ‹ Authorization ν—¤λ”λ¥Ό μλ™μΌλ΅ μ¶”κ°€ν•  ν•„μ” μ—†μ
   - μ—λ¬ μ²λ¦¬ λ΅μ§μ„ ν• κ³³μ—μ„ κ΄€λ¦¬

2. **μλ™ ν† ν° κ°±μ‹ **
   - 401 λ°μƒ μ‹ κ°λ°μκ°€ λ³„λ„λ΅ μ²λ¦¬ν•  ν•„μ” μ—†μ΄ μλ™μΌλ΅ refresh ν›„ μ¬μ”μ²­
   - μ‚¬μ©μ κ²½ν— ν–¥μƒ (ν† ν° λ§λ£ μ‹μ—λ„ μλ™μΌλ΅ μ²λ¦¬)

3. **μ „μ—­ μ—λ¬ μ²λ¦¬**
   - 404/500 λ“± μ—λ¬ λ°μƒ μ‹ μΌκ΄€λ λ°©μ‹μΌλ΅ μ²λ¦¬
   - μ—λ¬ νμ΄μ§€λ΅ μλ™ λ¦¬λ‹¤μ΄λ ‰νΈν•μ—¬ μ‚¬μ©μμ—κ² λ…ν™•ν• ν”Όλ“λ°± μ κ³µ

### API ν΄λΌμ΄μ–ΈνΈ λ¶„λ¦¬ μ΄μ 

κ° API(HQ ERP, Client App, Vendor ERP)λ¥Ό λ³„λ„μ axios μΈμ¤ν„΄μ¤λ΅ λ¶„λ¦¬ν• μ΄μ :

1. **λ…λ¦½μ μΈ μ„¤μ •**
   - κ° APIλ§λ‹¤ λ‹¤λ¥Έ baseURL, timeout λ“± μ„¤μ • κ°€λ¥
   - APIλ³„λ΅ λ‹¤λ¥Έ μΈν„°μ…‰ν„° λ΅μ§ μ μ© κ°€λ¥

2. **μ—λ¬ μ¶”μ **
   - μ–΄λ–¤ APIμ—μ„ μ—λ¬κ°€ λ°μƒν–λ”μ§€ λ…ν™•ν μ‹λ³„ κ°€λ¥
   - μ—λ¬ λ΅κΉ… λ° λ¨λ‹ν„°λ§μ— μ λ¦¬

3. **μ μ§€λ³΄μμ„±**
   - νΉμ • APIμ μ„¤μ • λ³€κ²½μ΄ λ‹¤λ¥Έ APIμ— μν–¥μ„ μ£Όμ§€ μ•μ
   - μ½”λ“ κµ¬μ΅°κ°€ λ…ν™•ν•κ³  μ΄ν•΄ν•κΈ° μ‰¬μ›€

### μ‹¤μ  ν”„λ΅μ νΈ μ μ© μ‹ μ£Όμμ‚¬ν•­

1. **refreshAccessToken ν•¨μ μμ •**
   ```typescript
   // ν„μ¬ (λ°λ¨μ©)
   async function refreshAccessToken() {
     await new Promise((resolve) => setTimeout(resolve, 400));
     return "new-access-token";
   }
   
   // μ‹¤μ  ν”„λ΅μ νΈμ—μ„λ”
   async function refreshAccessToken() {
     const { refreshToken } = useAuthStore.getState();
     const response = await axios.post('/api/auth/refresh', { 
       refreshToken 
     });
     return response.data.accessToken;
   }
   ```

2. **μ—λ¬ νμ΄μ§€ μ»¤μ¤ν„°λ§μ΄μ§•**
   - ν„μ¬λ” λ‹¨μν μ—λ¬ μ •λ³΄λ§ ν‘μ‹ν•μ§€λ§, μ‹¤μ λ΅λ” μ¬μ‹λ„ λ²„νΌ, ν™μΌλ΅ κ°€κΈ° λ“± μ¶”κ°€ κΈ°λ¥ ν•„μ”

3. **λ΅λ”© μƒνƒ κ΄€λ¦¬**
   - refresh μ¤‘μΌ λ• λ΅λ”© ν‘μ‹λ¥Ό μ¶”κ°€ν•λ©΄ μ‚¬μ©μ κ²½ν—μ΄ ν–¥μƒλ©λ‹λ‹¤

## π― μ‹μ—° μ‹λ‚λ¦¬μ¤

### μ‹λ‚λ¦¬μ¤ 1: μ •μƒ API νΈμ¶
1. ν† ν° μ…λ ¥ (μ: `demo-access`, `demo-refresh`)
2. "ν† ν° μ €μ¥" ν΄λ¦­
3. κ° API μΉ΄λ“μ "μ •μƒ νΈμ¶" λ²„νΌ ν΄λ¦­
4. μ •μƒ μ‘λ‹µ ν™•μΈ

### μ‹λ‚λ¦¬μ¤ 2: 401 ν† ν° λ§λ£ μ²λ¦¬
1. Access Tokenμ— `expired` μ…λ ¥
2. "ν† ν° μ €μ¥" ν΄λ¦­
3. κ° API μΉ΄λ“μ "π”µ 401" λ²„νΌ ν΄λ¦­
4. μ½μ†”μ—μ„ refresh κ³Όμ • ν™•μΈ
5. μ„±κ³µ μ•λ¦Ό ν™•μΈ

### μ‹λ‚λ¦¬μ¤ 3: 404/500 μ—λ¬ μ²λ¦¬
1. κ° API μΉ΄λ“μ "π”΄ 404" λλ” "π  500" λ²„νΌ ν΄λ¦­
2. μλ™μΌλ΅ `/error` νμ΄μ§€λ΅ μ΄λ™
3. μ—λ¬ μ •λ³΄ ν™•μΈ
4. "ν™μΌλ΅ λμ•„κ°€κΈ°" ν΄λ¦­

## π“ μ‚¬μ©λ λΌμ΄λΈλ¬λ¦¬

- **Next.js 14** - React ν”„λ μ„μ›ν¬
- **React 18** - UI λΌμ΄λΈλ¬λ¦¬
- **axios** - HTTP ν΄λΌμ΄μ–ΈνΈ
- **Zustand** - μƒνƒ κ΄€λ¦¬ (ν† ν° μ €μ¥)
- **TanStack Query** - λ°μ΄ν„° νμΉ­ λ° μΊμ‹±
- **React Hook Form** - νΌ κ΄€λ¦¬
- **Zod** - μ¤ν‚¤λ§ κ²€μ¦
- **Tailwind CSS** - μ¤νƒ€μΌλ§

## π¤ ν€μ› μ§λ¬Έ FAQ

**Q: 401μ΄ λ°μƒν•λ©΄ λ¬΄μ΅°κ±΄ refreshλ¥Ό μ‹λ„ν•λ‚μ”?**  
A: λ„¤, ν•μ§€λ§ `_retry` ν”λκ·Έλ΅ ν• λ²λ§ μ¬μ‹λ„ν•©λ‹λ‹¤. refreshκ°€ μ‹¤ν¨ν•λ©΄ μ—λ¬λ¥Ό λ°ν™ν•©λ‹λ‹¤.

**Q: μ—¬λ¬ APIλ¥Ό λ™μ‹μ— νΈμ¶ν•  λ• 401μ΄ λ°μƒν•λ©΄?**  
A: `isRefreshing` ν”λκ·Έμ™€ `refreshQueue`λ¥Ό μ‚¬μ©ν•μ—¬ refreshλ” ν• λ²λ§ μ‹¤ν–‰ν•κ³ , λ¨λ“  μ”μ²­μ΄ μƒ ν† ν°μ„ λ°›μ•„μ„ μ¬μ‹λ„ν•©λ‹λ‹¤.

**Q: 404/500λ„ μλ™μΌλ΅ μ¬μ‹λ„ν•λ‚μ”?**  
A: μ•„λ‹μ”, 404/500μ€ μ¬μ‹λ„ν•μ§€ μ•κ³  λ°”λ΅ μ—λ¬ νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰νΈν•©λ‹λ‹¤. 401λ§ μλ™μΌλ΅ refresh ν›„ μ¬μ‹λ„ν•©λ‹λ‹¤.

**Q: λ‹¤λ¥Έ API ν΄λΌμ΄μ–ΈνΈλ¥Ό μ¶”κ°€ν•λ ¤λ©΄?**  
A: `src/lib/axios.ts`μ `API_BASES`μ— μ¶”κ°€ν•κ³ , `createApiClient`λ΅ μƒ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•λ©΄ λ©λ‹λ‹¤.

## π“ μ¶”κ°€ κ°μ„  μ‚¬ν•­

- [ ] refresh μ‹¤ν¨ μ‹ λ΅κ·ΈμΈ νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰νΈ
- [ ] refresh μ¤‘ λ΅λ”© μƒνƒ ν‘μ‹
- [ ] μ—λ¬ μ¬μ‹λ„ λ²„νΌ μ¶”κ°€
- [ ] ν† ν° λ§λ£ μ‹κ°„ μ²΄ν¬ λ° μ‚¬μ „ refresh
